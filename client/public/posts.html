<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>post</title>

    <link rel="stylesheet" href="newinfo.css">
    <link rel="stylesheet" href="slider+containerasmodel.css">
    <script src="script.js"></script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApx6pFCY0XlU4mSWReK9AOs8BdMhLoLco&libraries=geometry"></script>

</head>

<body>
    <div id="navbar">
        <h1>Swarat</h1>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="profile.html">profile</a></li>
            <li><a href="login.html">Login</a></li>
        </ul>

    </div>
    <div class="container">
        <div class="post_heading">
            <h2>POST</h2>
        </div>
        <div class="post_cont">

        </div>
    </div>

    <div class="bg-modal">
        <div class="modal-content">
            <div class="close">+</div>
            <div id="slider">
                <ul id="slideWrap">
                    <li><img src="download (1).jpg" alt=""></li>
                    <li><img src="images.jpg" alt=""></li>
                    <li><img src="depositphotos_18781011-stock-illustration-indian-flag-color-creative-wave.jpg" alt="">
                    </li>
                    <li><img src="7xm.xyz486207.jpg" alt=""></li>
                    <li><img src="7xm.xyz893289.jpg" alt=""></li>
                </ul>
                <a id="prev" href="#">&#8810;</a>
                <a id="next" href="#">&#8811;</a>
            </div>
            <div class="box">
                <div class="contentbox">
                    <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Delectus tempora id dignissimos sed
                        pariatur at ad natus commodi beatae reprehenderit, soluta voluptate a assumenda aut cumque
                        saepe, vero amet explicabo!</p>
                </div>
                <button class="submit" type="button">volunteer</button>
            </div>
        </div>
    </div>
    <script>


        var responsiveSlider = function () {

            var slider = document.getElementById("slider");
            var sliderWidth = slider.offsetWidth;
            var slideList = document.getElementById("slideWrap");
            var count = 1;
            var items = slideList.querySelectorAll("li").length;
            var prev = document.getElementById("prev");
            var next = document.getElementById("next");

            window.addEventListener('resize', function () {
                sliderWidth = slider.offsetWidth;
            });

            var prevSlide = function () {
                if (count > 1) {
                    count = count - 2;
                    slideList.style.left = "-" + count * sliderWidth + "px";
                    count++;
                }
                else if (count = 1) {
                    count = items - 1;
                    slideList.style.left = "-" + count * sliderWidth + "px";
                    count++;
                }
            };

            var nextSlide = function () {
                if (count < items) {
                    slideList.style.left = "-" + count * sliderWidth + "px";
                    count++;
                }
                else if (count = items) {
                    slideList.style.left = "0px";
                    count = 1;
                }
            };

            next.addEventListener("click", function () {
                nextSlide();
            });

            prev.addEventListener("click", function () {
                prevSlide();
            });

            setInterval(function () {
                nextSlide()
            }, 5000);

        };

        window.onload = function () {
            responsiveSlider();
        }


    </script>
    <script>
        
        
        function calcCrow(lat1, lon1, lat2, lon2) 
        {
          var R = 6371; // km
          var dLat = toRad(lat2-lat1);
          var dLon = toRad(lon2-lon1);
          var lat1 = toRad(lat1);
          var lat2 = toRad(lat2);

          var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
          var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
          var d = R * c;
          return d;
        }

        // Converts numeric degrees to radians
        function toRad(Value) 
        {
            return Value * Math.PI / 180;
        }
        
        //getLocation();
        
        function onResponse(response) {
            return response.json();
        }
        fetch(`http://localhost:3001/getPopulate`)
            .then(onResponse)
            .then(json => {
            




                console.log(json.length)
                for (let i = 0; i < json.length; i++) {

                    const post_container = document.querySelector('.post_cont');
                    // console.log(post_container);

                    const post = document.createElement('div');
                    // console.log(post);
                    post.classList.add('post');

                    const post_img = document.createElement('div');
                    post_img.classList.add('post_img');

                    const img = document.createElement('img');
                    img.src = 'http://localhost:3001/download/' + json[i].pictures;
                    console.log(img)
                    img.alt = 'anything';

                    //src
                    const post_info = document.createElement('div');
                    post_info.classList.add('post_info');

                    const h1 = document.createElement('h1');
                    h1.classList.add('post_title');
                    
                    
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(position => {
                            //console.log('dist ' + )
                            h1.textContent = Math.round(calcCrow(json[i].location.lat, json[i].location.lng, position.coords.latitude, position.coords.longitude)) + ' kms away';
                        });
                        
                    
                    }
                    
                    const para = document.createElement('p');
                    para.classList.add('post_text');
                    para.textContent = json[i].description;

                    const a = document.createElement('a');

                    a.classList.add('post_cta');
                    a.textContent = "Read More";

                    var but = document.createElement('a');
                    but.href = `http://localhost:3000/chat/${json[i].chatid}`;
                    but.classList.add('post_cta');
                    but.textContent = "Chat"
                    var buta = document.createElement('a');
                    buta.href = "http://localhost:3000/gmaps.html";
                    buta.classList.add('post_cta');
                    buta.textContent = "View in Map"
                    post_container.appendChild(post);
                    post.appendChild(post_img);
                    post.appendChild(post_info);

                    post_img.appendChild(img);

                    post_info.appendChild(h1);
                    post_info.appendChild(para);
                    post_info.appendChild(a);
                    post_info.appendChild(but);
                    post_info.appendChild(buta);


                    a.addEventListener("click", function () {
                        console.log(json[i].id)

                        fetch(`http://localhost:3001/clickedOnPost?id=${json[i].id}`).then(
                            res => {

                            }
                        )
                    });

                }

            });



    </script>
    <script>
        // document.querySelectorAll('.post_cta').addEventListener('click',function(){
        //     document.querySelector('.bg-modal').style.display ='flex';
        // });




    </script>
</body>

</html>
